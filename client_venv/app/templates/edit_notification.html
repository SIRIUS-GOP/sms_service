{% extends 'base.html' %}
{% set active_page = "notifications" %}

{% block main %}
<h1 class="header_text">Edit Notification</h1>
<div class='add_text' style='line-height: 12px;'>
    <p>▸ Expiration Date: Set a date and time to the notification expirate;</p>
    <p>▸ PV Name or Filter: Type in the PV name or a RegEx filter for multiple PVs;</p>
    <p>▸ Rule: Choose one between the list. You can add a new rule in the Rules menu;</p>
    <p>▸ Limit(s): Type in the limit(s) ot your rule. Use L=&#60value&#62 for a single limit,</p>
    <p style="margin-left: 50px">LL=&#60value&#62 or LU=&#60value&#62 for other cases;</p>
    <p style="margin-left: 50px;">Example 1) 'L=100' / Example 2) 'L=5e-8' / Example 3) 'LL=0;LU=1e-7'</p>
    <p>▸ Owner: This field is unchangeable, linked to your account;</p>
    <p>▸ Phone Number: it follows the format displayed in the field on selecting it;</p>
</div>
<form autocomplete="off" class="form" method="post">
    <div class="form-field-line">
        <div class="form-field" style="padding-top: 10px;">
            <label class="label" for="expiration">Expiration Date:</label><br>
            <input type="text" id="datetimepicker" name="expiration" {%if 
                    (current_user.username==notification[6] or 
                    current_user.username=='admin')%} enabled {%else%} disabled {%endif%}
                    placeholder="Choose the expiration date..." class="form-control"
                    value="{{ request.form['expiration'] or notification[2] }}"></input>
        <script>
        $(function(){
            $.datetimepicker.setLocale('en');
            $('#datetimepicker').datetimepicker({
                format:"Y-m-d H:i:00",
                timeDisplayFormat: "hh:mm:ss",
            });
        });
        </script>
        </div>
        <div class="form-field">
            <div class="ui-widget">
                <label class="pv" for="pv">PV Name or Filter:</label><br>
                <input class="pv" type="text" name="pv" {%if (current_user.username==notification[6] 
                    or current_user.username=='admin')%} enabled {%else%} disabled {%endif%}
                    placeholder="Type in the PV name..." id="pv"
                    value="{{ request.form['pv'] or notification[3] }}"></input>
            </div>
        </div>
    </div>
    <div class="form-field-line">
        <div class="form-field">
            <label class="label" for="rule">Rule:</label><br>
            <select class="rule" name="rule" id="rule"{%if (current_user.username==notification[6] 
                or current_user.username=='admin')%} enabled {%else%} disabled {%endif%}>
                {% for row in rules %}
                    <option value="{{ row.rule }}" {% if row.rule==notification[4] %} selected="selected" 
                    {% endif %}>{{ row.description + ' : ' + row.rule}}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="form-field-line">
        <div class="form-field">
            <label class="label" for="limits">Limit(s):</label><br>
            <input class="limits" type="text" name="limits" {%if (current_user.username==notification[6] 
                or current_user.username=='admin')%} enabled {%else%} disabled {%endif%}
                placeholder="Type in the value..." class="form-control"
                value="{{ request.form['limits'] or notification[5] }}"></input>
        </div>
        <div class="form-field">
            <label class="label" for="phone">Owner:</label><br>
            <input class="owner" type="text" name="owner" {%if (current_user.username==notification[6]
                or current_user.username=='admin')%} enabled {%else%} disabled {%endif%}
                placeholder="Type in the owner of the rule.." class="form-control"
                value="{{ request.form['owner'] or notification[6] }}" readonly></input>   
        </div>
    </div>
    <div class="form-field-line">
        <div class="form-field">
            <label class="label" for="phone">Phone Number:</label><br>
            <input class="phone" type="text" name="phone" {%if (current_user.username==notification[6] or current_user.username=='admin')%} id="phone"
                style="color:black" enabled{%else%} disabled {%endif%}
                placeholder="Type in the phone number..." class="form-control"
                value={%if (current_user.username==notification[6] or current_user.username=='admin')%}"{{ request.form['phone'] or notification[7] }}"
                {%else%}"{{ request.form['phone'] or '(??)?????-????' }}"{%endif%}></input>   
        </div>
        <div class="form-field" id="form-field" {% if notification[11]==0 %}style="display:none;" {%endif%}>
            <label class="label" for="interval">Interval:</label><br>
            <input class="interval" type="text" name="interval" {%if (current_user.username==notification[6]
                or current_user.username=='admin')%} enabled {%else%} disabled {%endif%}
                placeholder="Type the value in minutes, minimum of 10..."
                value="{%if notification[11]==1%}{{ request.form['interval'] or notification[10] }}{%else%}{%endif%}"></input>               
        </div>
    </div>
    <div class="form-field-line">
        <div class="form-field">
            <label class="persistent" for="persistent">Persistent?</label><br>
            <input type="checkbox" class="persistent" type="text" name="persistent" id="persistent"
                value={{notification[11] or request.form['persistent']}} checked="{% if notification[11]%} or request.form['persistent'] {%endif%}"></input>   
        </div>
        <div class="form-field" {%if current_user.username!='admin' %} style="display:none;" {%endif%}>
            <label class="label" for="sent">Sent:</label><br>
            <input class="sent" type="checkbox" name="sent"
                placeholder="Sent status" class="form-control"
                value={{notification[8] or request.form['sent']}} checked="{% if notification[8]%} or request.form['sent'] {%endif%}"></input>
        </div>
    </div>
    <br>
    <span class="action-buttons">
        <span class="action-buttons" style="padding: 10px 10px 10px 0px;">
            <button type="submit" class="btn-submit" value='accept' name='action'>Submit</button>
        </span>
        <span class="action-buttons" style="padding: 10px 10px 10px 0px;">
            <button type="submit" class="btn-cancel" value='cancel' name='action'>Cancel</button>
        </span>
        <span class="action-buttons" style="padding: 10px 10px 10px 0px;">
            <button type="submit" class="btn-delete" value='delete' name='action' onclick="return confirm('Are you sure?');">Delete</button>
        </span>
    </span>
</form>
{% endblock %}